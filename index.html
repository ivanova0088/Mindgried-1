<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MindGrid â€“ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ù‚ÙˆÙ„</title>
  <meta name="theme-color" content="#0891b2"/>
  <link rel="manifest" href="manifest.json"><!-- Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø§Ù„Ø¢Ù† -->
  <style>
    :root{
      --bg1:#e7f3ff; --bg2:#ffffff; --fg:#0a0f14; --muted:#586174; --card:#ffffff; --line:#d9e4ef;
      --brand:#0891b2; --accent:#0ea5e9; --good:#10b981; --warn:#f97316; --bad:#ef4444;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg1:#0b1b2a; --bg2:#00121d; --fg:#e7eef7; --muted:#a6b3c4; --card:#0e2233; --line:#13354a;
        --brand:#38bdf8; --accent:#22d3ee; --good:#34d399; --warn:#fb923c; --bad:#f87171;
      }
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Naskh Arabic UI','Noto Sans Arabic',Tahoma,Arial,sans-serif;
      color:var(--fg);
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      min-height:100svh;
    }
    header{
      display:flex; align-items:center; gap:12px; padding:16px 18px; border-bottom:1px solid var(--line);
      backdrop-filter:saturate(1.2) blur(6px);
    }
    .logo{width:40px;height:40px;border-radius:10px;background:radial-gradient(circle at 30% 30%, var(--accent), var(--brand));}
    h1{font-size:18px; margin:0}
    .sub{font-size:12px; opacity:.8; margin-top:2px}
    .coins{margin-inline-start:auto; padding:8px 12px; border:1px solid var(--line); background:var(--card); border-radius:999px; font-weight:700}
    main{max-width:820px; margin:auto; padding:18px}
    .grid{display:grid; grid-template-columns:1fr; gap:14px}
    @media (min-width:560px){ .grid{grid-template-columns:1fr 1fr} }
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:0 8px 24px rgba(2,6,23,.06);
    }
    .card h2{margin:0 0 8px 0; font-size:16px}
    .btn{display:inline-block; padding:10px 14px; border-radius:12px; border:1px solid var(--line); background:var(--bg2); color:var(--fg); font-weight:700; cursor:pointer}
    .btn.brand{background:var(--brand); color:white; border-color:transparent}
    .btn.ghost{background:transparent}
    .row{display:flex; gap:8px; flex-wrap:wrap}
    .hint{font-size:12px; color:var(--muted)}
    .sep{height:1px;background:var(--line);margin:12px 0}
    .hidden{display:none}
    .pill{display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; border:1px solid var(--line); font-size:12px}
    .list{display:grid; gap:10px}
    .item{padding:12px;border:1px solid var(--line);border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,.08),transparent)}
    input[type="text"]{width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line); background:var(--bg2); color:var(--fg)}
    .success{color:var(--good)} .warn{color:var(--warn)} .danger{color:var(--bad)}
    footer{opacity:.6; text-align:center; padding:24px 12px; font-size:12px}
  </style>
</head>
<body>
  <header>
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>MindGrid â€“ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ù‚ÙˆÙ„</h1>
      <div class="sub">ÙƒÙ„Ù…Ø§Øª Ù…ØªÙ‚Ø§Ø·Ø¹Ø© ÙˆØ£Ù„ØºØ§Ø² ÙŠÙˆÙ…ÙŠØ©</div>
    </div>
    <div id="coins" class="coins">ğŸª™ 0</div>
  </header>

  <main>
    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <section id="home" class="grid">
      <div class="card">
        <h2>ğŸ§© Ø£Ù„ØºØ§Ø² Ø§Ù„ÙŠÙˆÙ…</h2>
        <div class="hint">5 Ø£Ù„ØºØ§Ø² Ù…ØªØ¬Ø¯Ø¯Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ â€¢ ØªÙ„Ù…ÙŠØ­Ø§Øª â€¢ Ù…ÙƒØ§ÙØ¢Øª</div>
        <div class="sep"></div>
        <div class="row">
          <button class="btn brand" onclick="nav('daily')">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
          <button class="btn ghost" onclick="showHow()">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
        </div>
      </div>
      <div class="card">
        <h2>ğŸ† Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</h2>
        <div class="hint">ÙˆØ§Ø¬Ù‡Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¶Ø¯ Ø®ØµÙ… ÙˆÙ‡Ù…ÙŠ â€¢ +50 Ø¹Ù…Ù„Ø© Ù„Ù„ÙÙˆØ²</div>
        <div class="sep"></div>
        <button class="btn" onclick="nav('versus')">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
      </div>
      <div class="card">
        <h2>ğŸ› Ø§Ù„Ù…ØªØ¬Ø±</h2>
        <div class="hint">Ø§Ø´ØªØ±Ù ØªÙ„Ù…ÙŠØ­Ø§Øª (10) Ø£Ùˆ ØªØ®Ø·ÙŠ (25)</div>
        <div class="sep"></div>
        <button class="btn" onclick="nav('store')">Ø§ÙØªØ­ Ø§Ù„Ù…ØªØ¬Ø±</button>
      </div>
      <div class="card">
        <h2>ğŸ”¥ Ø§Ù„Ø³ØªØ±ÙŠÙƒ (Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©)</h2>
        <div id="streakBox" class="pill">0 ÙŠÙˆÙ…</div>
        <div class="hint" id="streakHint">Ø§Ø¯Ø®Ù„ ÙƒÙ„ ÙŠÙˆÙ… Ù„ØªØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³ØªØ±ÙŠÙƒ. ÙŠÙ†ÙƒØ³Ø± Ø¨Ø¹Ø¯ 24 Ø³Ø§Ø¹Ø©.</div>
      </div>
    </section>

    <!-- Ø£Ù„ØºØ§Ø² Ø§Ù„ÙŠÙˆÙ… -->
    <section id="daily" class="hidden">
      <div class="row" style="margin-bottom:12px">
        <button class="btn" onclick="nav('home')">â¬… Ø±Ø¬ÙˆØ¹</button>
        <div class="pill">ğŸª™ <span id="coins2">0</span></div>
      </div>
      <div class="list" id="puzzles"></div>
    </section>

    <!-- Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© -->
    <section id="versus" class="hidden">
      <div class="row" style="margin-bottom:12px">
        <button class="btn" onclick="nav('home')">â¬… Ø±Ø¬ÙˆØ¹</button>
        <div class="pill">ğŸª™ <span id="coins3">0</span></div>
      </div>
      <div class="card">
        <h2>ğŸ ØªØ­Ø¯Ù‘ÙŠ Ø³Ø±ÙŠØ¹</h2>
        <div class="hint">Ø³ÙŠØ¸Ù‡Ø± Ù†ÙØ³ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù„Ùƒ ÙˆÂ«Ø®ØµÙ… ÙˆÙ‡Ù…ÙŠÂ». Ø¥Ù† Ø£Ø¬Ø¨Øª Ø£Ø³Ø±Ø¹ ØªÙÙˆØ² +50 ğŸª™</div>
        <div class="sep"></div>
        <div id="versusArea">
          <div class="item">
            <div id="vq" style="margin-bottom:8px;font-weight:700"></div>
            <input id="va" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø§"/>
            <div class="row" style="margin-top:8px">
              <button class="btn brand" onclick="submitVersus()">ØªØ­Ù‚Ù‚</button>
              <button class="btn" onclick="newVersus()">ØªØ­Ø¯Ù‘ÙŠ Ø¬Ø¯ÙŠØ¯</button>
            </div>
            <div id="vstatus" class="hint" style="margin-top:8px"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Ø§Ù„Ù…ØªØ¬Ø± -->
    <section id="store" class="hidden">
      <div class="row" style="margin-bottom:12px">
        <button class="btn" onclick="nav('home')">â¬… Ø±Ø¬ÙˆØ¹</button>
        <div class="pill">ğŸª™ <span id="coins4">0</span></div>
      </div>
      <div class="list">
        <div class="item">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><b>ØªÙ„Ù…ÙŠØ­ ÙÙˆØ±ÙŠ</b><div class="hint">ÙŠØ¸Ù‡Ø± Ø­Ø±Ù/ÙƒÙ„Ù…Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© â€¢ Ø§Ù„ØªÙƒÙ„ÙØ© 10</div></div>
            <button class="btn" onclick="buy('hint')">Ø´Ø±Ø§Ø¡ 10ğŸª™</button>
          </div>
        </div>
        <div class="item">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><b>ØªØ®Ø·ÙŠ Ù„ØºØ²</b><div class="hint">ØªØ¹ØªØ¨Ø±Ù‡ Ù…Ø­Ù„ÙˆÙ„Ø§Ù‹ â€¢ Ø§Ù„ØªÙƒÙ„ÙØ© 25</div></div>
            <button class="btn" onclick="buy('skip')">Ø´Ø±Ø§Ø¡ 25ğŸª™</button>
          </div>
        </div>
        <div class="item">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><b>Ø¨Ø§Ù‚Ø© Ø¯Ø¹Ù… MindGrid</b><div class="hint">+200 Ø¹Ù…Ù„Ø© Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„ØªØ·ÙˆÙŠØ±</div></div>
            <button class="btn" onclick="grant(200)">Ø¯Ø¹Ù… +200ğŸª™</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
    <section id="how" class="hidden">
      <div class="row" style="margin-bottom:12px">
        <button class="btn" onclick="nav('home')">â¬… Ø±Ø¬ÙˆØ¹</button>
      </div>
      <div class="card">
        <h2>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</h2>
        <div class="list">
          <div class="item">ğŸ¯ Ù„Ø¯ÙŠÙƒ 5 Ø£Ù„ØºØ§Ø² ÙŠÙˆÙ…ÙŠÙ‹Ø§. ÙƒÙ„ Ø­Ù„ ØµØ­ÙŠØ­ ÙŠØ¹Ø·ÙŠÙƒ Ø¹Ù…Ù„Ø§Øª.</div>
          <div class="item">ğŸ’¡ ØªØ³ØªØ·ÙŠØ¹ Ø£Ø®Ø° ØªÙ„Ù…ÙŠØ­ (âˆ’10ğŸª™) Ø£Ùˆ ØªØ®Ø·ÙŠ Ù„ØºØ² (âˆ’25ğŸª™).</div>
          <div class="item">ğŸ”¥ Ø§Ù„Ø³ØªØ±ÙŠÙƒ: Ø§Ø¯Ø®Ù„ ÙƒÙ„ ÙŠÙˆÙ… Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ¢Øª ØªØµØ§Ø¹Ø¯ÙŠØ©. ÙŠÙ†ÙƒØ³Ø± Ø¨Ø¹Ø¯ 24 Ø³Ø§Ø¹Ø©.</div>
          <div class="item">ğŸ† Ø§Ù„ØªØ­Ø¯Ù‘ÙŠ: Ø£Ø¬Ø¨ Ø£Ø³Ø±Ø¹ Ù…Ù† Ø§Ù„Ø®ØµÙ… Ø§Ù„ÙˆÙ‡Ù…ÙŠ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ +50ğŸª™.</div>
        </div>
      </div>
    </section>
  </main>

  <footer>Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© â€“ MindGrid</footer>

  <script>
  // ====== ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ ======
  const S = {
    coins: 'mg_coins',
    streak: 'mg_streak',
    dayKey: 'mg_day',
    solved: 'mg_solved',
    inventory: 'mg_inv'
  };

  const todayKey = () => new Date().toISOString().slice(0,10);

  function getCoins(){ return +(localStorage.getItem(S.coins) || 100); }
  function setCoins(v){ localStorage.setItem(S.coins, v); syncCoins(); }
  function syncCoins(){
    const c = getCoins();
    ['coins','coins2','coins3','coins4'].forEach(id=>{
      const el = document.getElementById(id);
      if(el) el.textContent = c;
    });
  }

  // Ø³ØªØ±ÙŠÙƒ ØµØ§Ø±Ù… 24 Ø³Ø§Ø¹Ø©
  function updateStreak(){
    let st = JSON.parse(localStorage.getItem(S.streak) || '{"count":0,"last":""}');
    const last = st.last ? new Date(st.last) : null;
    const now = new Date();
    const lastKey = st.last?.slice(0,10);
    const tKey = todayKey();
    if(!last){
      st = {count:1, last: now.toISOString()};
      rewardStreak(st.count);
    }else{
      if(lastKey === tKey){
        // Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ…: Ù„Ø§ Ø´ÙŠØ¡
      }else{
        const diff = Math.floor((now - new Date(tKey+"T00:00:00Z"))/86400000) -
                     Math.floor((new Date(st.last.slice(0,10)+"T00:00:00Z") - new Date(tKey+"T00:00:00Z"))/86400000);
        // Ø­Ø³Ø§Ø¨ Ø¨Ø³ÙŠØ·: Ù‡Ù„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠØŸ (ÙØ±Ù‚ ÙŠÙˆÙ…)
        const lastDay = new Date(st.last.slice(0,10));
        const d = Math.round((new Date(tKey) - lastDay) / 86400000);
        if(d === 1){
          st.count += 1;
          rewardStreak(st.count);
        }else if(d >= 2){
          st.count = 1;
          rewardStreak(st.count);
        }
      }
      st.last = now.toISOString();
    }
    localStorage.setItem(S.streak, JSON.stringify(st));
    renderStreak();
  }

  function rewardStreak(n){
    // +5 ØªØµØ§Ø¹Ø¯ÙŠÙ‹Ø§ Ø­ØªÙ‰ 50ØŒ ÙˆØ§Ù„ÙŠÙˆÙ… 7 ØªÙ„Ù…ÙŠØ­ Ù…Ø¬Ø§Ù†ÙŠ (Ù†Ø­ÙˆÙ‘Ù„Ù‡ +10 Ø¹Ù…Ù„Ø© Ù…ÙƒØ§ÙØ£Ø©)
    const base = Math.min(5*n, 50);
    setCoins(getCoins() + base + (n===7 ? 10 : 0));
  }

  function renderStreak(){
    const st = JSON.parse(localStorage.getItem(S.streak) || '{"count":0,"last":""}');
    const el = document.getElementById('streakBox');
    if(el) el.textContent = st.count + ' ÙŠÙˆÙ…';
  }

  // Ø¬Ù„Ø¨/ØªÙˆÙ„ÙŠØ¯ Ø£Ù„ØºØ§Ø² Ø§Ù„ÙŠÙˆÙ… (Ø«Ø§Ø¨ØªØ© Ù…Ø­Ù„ÙŠÙ‹Ø§ Ù„Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©)
  function getTodayPuzzles(){
    const key = 'mg_puzzles_'+todayKey();
    const cached = localStorage.getItem(key);
    if(cached) return JSON.parse(cached);
    // Ø®Ù…Ø³Ø© Ø£Ù„ØºØ§Ø² Ù…ØªÙ†ÙˆØ¹Ø© (Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø©)
    const puzzles = [
      {id:'p1', type:'text', q:'Ù…Ø¯ÙŠÙ†Ø© Ø¹Ø±Ø¨ÙŠØ©: Ø¹Ø§ØµÙ…Ø© Ø°Ø§Øª Ø³ÙˆØ± ØªØ§Ø±ÙŠØ®ÙŠØŒ Ø£Ø´Ù‡Ø± Ù…Ø¹Ø§Ù„Ù…Ù‡Ø§ Ø§Ù„Ù‚Ù„Ø¹Ø© (6 Ø­Ø±ÙˆÙ).', a:'Ø­Ù„Ø¨', reward:20, hint:'ØªÙ‚Ø¹ ÙÙŠ Ø³ÙˆØ±ÙŠØ§.'},
      {id:'p2', type:'text', q:'Ø´ÙŠØ¡ Ø¥Ø°Ø§ ØªÙƒÙ„Ù…ØªÙ Ø¨Ù‡ ÙƒØ³Ø±ØªÙ‡.', a:'Ø§Ù„ØµÙ…Øª', reward:20, hint:'Ø¹ÙƒØ³ Ø§Ù„Ø¶Ø¬ÙŠØ¬.'},
      {id:'p3', type:'text', q:'ÙƒØ§ØªØ¨ Ø¹Ø§Ù„Ù…ÙŠ: ØµØ§Ø­Ø¨ "Ø§Ù„Ø¬Ø±ÙŠÙ…Ø© ÙˆØ§Ù„Ø¹Ù‚Ø§Ø¨" (Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©).', a:'Ø¯ÙˆØ³ØªÙˆÙŠÙØ³ÙƒÙŠ', reward:25, hint:'Ø±ÙˆØ§Ø¦ÙŠ Ø±ÙˆØ³ÙŠ.'},
      {id:'p4', type:'text', q:'ÙƒÙ„Ù…Ø© Ù…Ù† 4 Ø­Ø±ÙˆÙ: Ù…Ø§Ø¡ Ù…ØªØ¬Ù…Ø¯.', a:'Ø«Ù„Ø¬', reward:15, hint:'Ø£Ø¨ÙŠØ¶..'},
      {id:'p5', type:'text', q:'Ù…Ø¯ÙŠÙ†Ø© Ø¹Ø±Ø¨ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙŠØ¬ØŒ Ø§Ø³Ù…Ù‡Ø§ Ù…Ù† 5 Ø­Ø±ÙˆÙ.', a:'Ø§Ù„Ø¯ÙˆØ­Ø©', reward:20, hint:'ØªØ³ØªØ¶ÙŠÙ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø±ÙŠØ§Ø¶ÙŠØ© ÙƒØ¨ÙŠØ±Ø©.'},
    ];
    localStorage.setItem(key, JSON.stringify(puzzles));
    return puzzles;
  }

  function renderPuzzles(){
    const box = document.getElementById('puzzles');
    box.innerHTML = '';
    const solvedKey = S.solved + '_' + todayKey();
    const solved = JSON.parse(localStorage.getItem(solvedKey) || '[]');
    getTodayPuzzles().forEach(p=>{
      const wrap = document.createElement('div'); wrap.className = 'item';
      const title = document.createElement('div'); title.style.fontWeight='700'; title.textContent = 'Ù„ØºØ²: ' + p.q;
      const input = document.createElement('input'); input.type='text'; input.placeholder = 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø§';
      const status = document.createElement('div'); status.className='hint'; status.style.marginTop='8px';
      const row = document.createElement('div'); row.className='row'; row.style.marginTop='8px';
      const btnCheck = document.createElement('button'); btnCheck.className='btn brand'; btnCheck.textContent='ØªØ­Ù‚Ù‚';
      const btnHint = document.createElement('button'); btnHint.className='btn'; btnHint.textContent='ØªÙ„Ù…ÙŠØ­ (10ğŸª™)';
      const btnSkip = document.createElement('button'); btnSkip.className='btn'; btnSkip.textContent='ØªØ®Ø·ÙŠ (25ğŸª™)';

      // Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙˆÙ„
      if(solved.includes(p.id)){
        status.innerHTML = 'âœ… Ù…Ø­Ù„ÙˆÙ„ â€¢ +'+p.reward+'ğŸª™';
        input.disabled = true; btnCheck.disabled = btnHint.disabled = btnSkip.disabled = true;
      }

      btnCheck.onclick = ()=>{
        const ans = (input.value || '').trim();
        if(!ans){ status.textContent='Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹.'; return; }
        if(normalize(ans) === normalize(p.a)){
          if(!solved.includes(p.id)){
            setCoins(getCoins() + p.reward);
            solved.push(p.id);
            localStorage.setItem(solvedKey, JSON.stringify(solved));
          }
          status.innerHTML = '<span class="success">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! +'+p.reward+'ğŸª™</span>';
          input.disabled = true; btnCheck.disabled = btnHint.disabled = btnSkip.disabled = true;
          syncCoins();
        }else{
          status.innerHTML = '<span class="danger">Ù„ÙŠØ³Øª ØµØ­ÙŠØ­Ø©.</span>';
        }
      };
      btnHint.onclick = ()=>{
        if(getCoins() < 10){ status.innerHTML = '<span class="warn">Ù„Ø§ ØªÙ…Ù„Ùƒ Ø¹Ù…Ù„Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ù„ØªÙ„Ù…ÙŠØ­.</span>'; return; }
        setCoins(getCoins()-10);
        status.innerHTML = 'ğŸ’¡ ØªÙ„Ù…ÙŠØ­: '+p.hint;
      };
      btnSkip.onclick = ()=>{
        if(getCoins() < 25){ status.innerHTML = '<span class="warn">Ù„Ø§ ØªÙ…Ù„Ùƒ Ø¹Ù…Ù„Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ù„ØªØ®Ø·ÙŠ.</span>'; return; }
        if(!solved.includes(p.id)){
          setCoins(getCoins()-25);
          solved.push(p.id);
          localStorage.setItem(solvedKey, JSON.stringify(solved));
          status.innerHTML = 'â­ ØªÙ… Ø§Ù„ØªØ®Ø·ÙŠ (âˆ’25ğŸª™)';
          input.disabled = true; btnCheck.disabled = btnHint.disabled = btnSkip.disabled = true;
          syncCoins();
        }
      };

      row.append(btnCheck, btnHint, btnSkip);
      wrap.append(title, input, row, status);
      box.append(wrap);
    });
  }

  // ØªØ·Ø¨ÙŠØ¹ Ø¨Ø³ÙŠØ· Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
  function normalize(s){ return s.toLowerCase().replace(/\s+/g,'').replace(/[Ø§Ø¥Ø¢]/g,'Ø§'); }

  // ØªÙ†Ù‚Ù‘Ù„
  function nav(id){
    ['home','daily','versus','store','how'].forEach(x=>{
      document.getElementById(x).classList.add('hidden');
    });
    document.getElementById(id).classList.remove('hidden');
    syncCoins();
    if(id==='daily') renderPuzzles();
    if(id==='versus') newVersus();
  }
  function showHow(){ nav('how'); }

  // Ø§Ù„Ù…ØªØ¬Ø±
  function buy(what){
    if(what==='hint'){
      if(getCoins()<10) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Øª ÙƒØ§ÙÙŠØ©.');
      setCoins(getCoins()-10);
      alert('ØªÙ… Ø´Ø±Ø§Ø¡ ØªÙ„Ù…ÙŠØ­. Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ØºØ².');
    }else if(what==='skip'){
      if(getCoins()<25) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Øª ÙƒØ§ÙÙŠØ©.');
      setCoins(getCoins()-25);
      alert('ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ®Ø·ÙŠ Ù„ØºØ² ÙˆØ§Ø­Ø¯ Ø¹Ø¨Ø± Ø²Ø± Ø§Ù„ØªØ®Ø·ÙŠ.');
    }
  }
  function grant(n){ setCoins(getCoins()+n); alert('Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¯Ø¹Ù…Ùƒ! +'+n+'ğŸª™'); }

  // Ø§Ù„ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„ÙˆÙ‡Ù…ÙŠ
  let vCurrent = null, vOpponentTime = null, vStart = null;
  const VQS = [
    {q:'Ù…Ø§ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ù…ØºØ±Ø¨ØŸ', a:'Ø§Ù„Ø±Ø¨Ø§Ø·'},
    {q:'Ù…Ø±Ø§Ø¯Ù: Ø³Ø±ÙŠØ¹ (5 Ø­Ø±ÙˆÙ).', a:'Ø®Ø§Ø·Ù'},
    {q:'Ù…Ø¬Ù…ÙˆØ¹ 17 + 28ØŸ', a:'45'},
    {q:'ÙƒØ§ØªØ¨ "Ø§Ù„Ø®ÙŠÙ…ÙŠØ§Ø¦ÙŠ" (Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ±).', a:'ÙƒÙˆÙŠÙ„Ùˆ'},
    {q:'Ø¨Ø­Ø± ÙŠÙØµÙ„ Ø£ÙˆØ±ÙˆØ¨Ø§ Ø¹Ù† Ø£ÙØ±ÙŠÙ‚ÙŠØ§ØŸ', a:'Ø§Ù„Ù…ØªÙˆØ³Ø·'}
  ];
  function newVersus(){
    vCurrent = VQS[Math.floor(Math.random()*VQS.length)];
    vOpponentTime = 3 + Math.floor(Math.random()*7); // Ø«ÙˆØ§Ù†ÙŠ
    vStart = Date.now();
    document.getElementById('vq').textContent = vCurrent.q;
    document.getElementById('va').value = '';
    document.getElementById('vstatus').textContent = 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†â€¦';
  }
  function submitVersus(){
    const sec = (Date.now()-vStart)/1000;
    const ans = (document.getElementById('va').value || '').trim();
    const ok = normalize(ans)===normalize(vCurrent.a);
    const st = document.getElementById('vstatus');
    if(!ok){ st.innerHTML = '<span class="danger">Ø¥Ø¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©.</span>'; return; }
    if(sec < vOpponentTime){
      setCoins(getCoins()+50);
      st.innerHTML = '<span class="success">ÙØ²Øª! ÙƒÙ†Øª Ø£Ø³Ø±Ø¹ Ù…Ù† Ø§Ù„Ø®ØµÙ…. +50ğŸª™</span>';
    }else{
      st.innerHTML = '<span class="warn">Ø§Ù„Ø®ØµÙ… Ø³Ø¨Ù‚Ùƒ Ø¨Ø«ÙˆØ§Ù†Ù Ù‚Ù„ÙŠÙ„Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</span>';
    }
    syncCoins();
  }

  // ØªÙ‡ÙŠØ¦Ø©
  function init(){
    if(!localStorage.getItem(S.coins)) setCoins(100);
    syncCoins();
    updateStreak();
    nav('home');
    // ØªØ³Ø¬ÙŠÙ„ Ø¹Ø§Ù…Ù„ Ø§Ù„Ø®Ø¯Ù…Ø© Ù„Ùˆ Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ Ù„Ø§Ø­Ù‚Ù‹Ø§
    if('serviceWorker' in navigator){
      fetch('sw.js',{method:'HEAD'}).then(r=>{
        if(r.ok) navigator.serviceWorker.register('sw.js');
      }).catch(()=>{});
    }
  }
  init();
  </script>
</body>
</html>
